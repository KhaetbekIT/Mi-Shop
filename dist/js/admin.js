(()=>{"use strict";let e="https://mi-shop-sever-api.onrender.com";const t=t=>(t=e+t,fetch(t).then((e=>e.json()))),n=(t,n)=>(t=e+t,fetch(t,n).then((e=>e.json()))),a=t=>(t=e+t,fetch(t,{method:"DELETE"}).then((e=>e.json())));(()=>{const e=document.querySelector("#category-name"),d=document.querySelector("#category-image"),r=document.querySelector("#category-add-btn"),o=document.querySelector("#category-container"),c=document.querySelector("#product-category"),i={name:"",image:""},u=()=>{""===e.value.trim()||""===d.value.trim()?r.disabled=!0:r.disabled=!1},s=()=>{t("/catalog").then((e=>{o.innerHTML="",e.map(((e,t)=>{const{id:n,name:a}=e;o.insertAdjacentHTML("beforeend",`\n                    <tr>\n                        <th scope="row">${t+1}</th>\n                        <td>${a}</td>\n                        <td class="text-end">\n                            <button type="button" class="btn btn-outline-danger btn-sm" data-category-id="${n}">\n                                удалить\n                            </button>\n                        </td>\n                    </tr>\n                `),c.insertAdjacentHTML("beforeend",`\n                    <option value="${n}">${a}</option>\n                `)}))}))};e.addEventListener("input",(()=>{i.name=e.value,u()})),d.addEventListener("input",(()=>{const e=d.files[0];if("image/jpeg"===e.type||"image/jpg"===e.type||"image/png"===e.type){const t=new FileReader;t.addEventListener("load",(()=>{i.image=t.result})),t.addEventListener("error",(()=>{i.image="",d.value=""})),t.readAsDataURL(e)}else d.value="";u()})),r.addEventListener("click",(()=>{n("/catalog",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then((t=>{d.value="",e.value="",s()}))})),o.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName){const t=e.target.dataset.categoryId;a(`/catalog/${t}`).then((e=>{s()}))}})),s(),u()})(),(()=>{const e=document.querySelector("#product-title"),d=document.querySelector("#product-name"),r=document.querySelector("#product-price"),o=document.querySelector("#product-image"),c=document.querySelector("#product-save-button"),i=document.querySelector("#product-category"),u=document.querySelector("#product-container"),s={title:"",productName:"",image:"",price:0,category:0},l=()=>{t("/products").then((e=>{u.innerHTML="",e.map(((e,t)=>{const{title:n,productName:a,price:d,id:r}=e;u.insertAdjacentHTML("beforeend",`\n                    <tr>\n                        <th scope="row">${t+1}</th>\n                        <td>${n}</td>\n                        <td>${a}</td>\n                        <td>${d} ₽</td>\n                        <td class="text-end">\n                            <button type="button" class="btn btn-outline-danger btn-sm" data-product-id="${r}">\n                                удалить\n                            </button>\n                        </td>\n                    </tr>   \n                `)}))}))},p=()=>{""===e.value.trim()||""===d.value.trim()||0===Number(r.value.trim())||""===o.value.trim()||"default"===i.value?c.disabled=!0:c.disabled=!1};i.addEventListener("change",(()=>{s.category=i.value;const e="default"!==i.value?`/products?category=${i.value}`:"/products";t(e).then((t=>{console.log(e),u.innerHTML="",t.map(((e,t)=>{const{title:n,productName:a,price:d,id:r}=e;u.insertAdjacentHTML("beforeend",`\n                    <tr>\n                        <th scope="row">${t+1}</th>\n                        <td>${n}</td>\n                        <td>${a}</td>\n                        <td>${d} ₽</td>\n                        <td class="text-end">\n                            <button type="button" class="btn btn-outline-danger btn-sm" data-product-id="${r}">\n                                удалить\n                            </button>\n                        </td>\n                    </tr>\n                `)}))})),p()})),e.addEventListener("input",(()=>{s.title=e.value})),d.addEventListener("input",(()=>{s.productName=d.value})),r.addEventListener("input",(()=>{s.price=Number(r.value)})),o.addEventListener("input",(()=>{const e=o.files[0];if("image/jpeg"===e.type||"image/jpg"===e.type||"image/png"===e.type){const t=new FileReader;t.addEventListener("load",(()=>{s.image=t.result})),t.addEventListener("error",(()=>{s.image="",o.value=""})),t.readAsDataURL(e)}else o.value="";p()})),c.addEventListener("click",(()=>{n("/products",{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then((t=>{e.value="",d.value="",r.value=0,o.value="",l()}))})),u.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName){const t=e.target.dataset.productId;a(`/products/${t}`).then((()=>{l()}))}})),p(),l()})()})();